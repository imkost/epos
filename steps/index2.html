<!doctype html>
<html>
  <body>
    <script src="27-fix-stream-rendering-with-fns.js"></script>
    <script>
      const store = createSource({
        show: true,
        items: ['a', 'b', 'c'],
        numbers: [
          { v: 1 },
          { v: 2 },
          { v: 3 },
          { v: 4 },
          { v: 5 },
          { v: 5 },
          { v: 6 },
          { v: 7 }
        ]
      })

      const strings = store.numbers.map$(number => {
        return `_"${number.v}"_`
      })

      const app = render({
        class: 'app',
        // inner: store.items.map$(char => {
        //   return [
        //     {
        //       tag: 'h2',
        //       inner: char.toUpperCase()
        //     },
        //     store.numbers.map$(number => {
        //       return {
        //         inner () {
        //           return number.v$
        //         }
        //       }
        //     })
        //   ]
        // })
        inner: [
          {
            inner: strings.map$(string => {
              return string
            })
          },

          () => {
            if (store.show$) {
              const uppered = store.items.map$(item => {
                return item.toUpperCase()
              })

              return uppered.map$(item => {
                return item + '-'
              })
            }

            return {
              tag: 'i',
              inner: 'nothing'
            }
          },

          {
            inner: store.items.map$(char => {
              return [
                {
                  tag: 'h2',
                  inner: char.toUpperCase()
                },
                store.numbers.map$(number => {
                  return () => {
                    if (store.show$) {
                      return [
                        {
                          inner: store.items.map$(char => {
                            return char.toUpperCase() + '-'
                          })
                        }
                      ]
                    }

                    return {
                      inner: 'not shown'
                    }
                  }
                })
              ]
            })
          }
        ]
      })

      document.body.appendChild(app)
    </script>
  </body>
</html>
