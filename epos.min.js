(()=>{var e=Object.prototype,r=Array.prototype,t={element:a},n=["tag","inner"],o=["abort","auxclick","beforecopy","beforecut","beforepaste","blur","cancel","canplay","canplaythrough","change","click","close","contextmenu","copy","cuechange","cut","dblclick","drag","dragend","dragenter","dragleave","dragover","dragstart","drop","durationchange","emptied","ended","error","focus","gotpointercapture","input","invalid","keydown","keypress","keyup","load","loadeddata","loadedmetadata","loadstart","lostpointercapture","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","mousewheel","paste","pause","play","playing","pointercancel","pointerdown","pointerenter","pointerleave","pointermove","pointerout","pointerover","pointerup","progress","ratechange","reset","resize","scroll","search","seeked","seeking","select","selectstart","stalled","submit","suspend","timeupdate","toggle","touchcancel","touchend","touchmove","touchstart","volumechange","waiting","wheel"].map(e=>`on${e}`);function a(e){if(Array.isArray(e))return l(e).map(a);if("number"==typeof e&&(e=e.toString()),"string"==typeof e)return document.createTextNode(e);!function(e){c(e.href)&&!e.tag&&(e.tag="a")}(e);var r=function(e){if("tag"in e){var r=e.tag;if(s(r)&&/^[\w-]+$/.test(r))return r;throw""}return"div"}(e),t=function(e){if("inner"in e)return l(e.inner).map(a);return[]}(e),n=document.createElement(r);for(var u in e)i(u)||(u.toLowerCase&&o.includes(u.toLowerCase())?n.addEventListener(u.slice(2),e[u]):y(n,u,e[u]));return t.forEach(e=>{n.appendChild(e)}),n}function i(e){return n.includes(e)}function s(e){return"string"==typeof e}function u(r){return"[object Object]"===e.toString.call(r)}function c(e){return s(e)&&e}function l(e){return Array.isArray(e)?function e(r){var t=[];r.forEach(r=>{Array.isArray(r)?t=t.concat(e(r)):t.push(r)});return t}(e):[e]}window.Epos={element:function(e){return e[f]?t.element(e):t.element(Epos.view(e))},object:m,view:h,stop:function(e){var r=p[p.length-1];if(r){r.freeze=!0;var t=e();r.freeze=!1}else var t=e();return t},hooks:function(e){return{[L]:e}}};var p=[],d=1,f=Symbol("affectsView");function h(e){return m(e,!0)}var v=[];function m(e,r=!1){e.inner&&(r=!0),r&&(e[f]=!0,e.id=`epos${d}`,d+=1);var n=new Proxy(e,{get:function(t,a){if(a.toLowerCase&&o.includes(a.toLowerCase()))return e[a];if(a===f)return e[f];if("__desc"===a)return e;if("__isProxy"===a)return!0;var i=k(n,a);if(!i)return e[a];if(!("value"in i)){var s=e[a];"function"==typeof s&&(p.push(i),s=s(),p.pop(),_(s)&&(s=m(s,r)),C(s)&&s.forEach((e,t)=>{_(e)&&(s[t]=m(e,r))})),i.value=s}if(p.length){var u=p[p.length-1];u.freeze||(i.infls.add(u),u.deps.add(i))}return i.value},set:function(o,a,i){var s=k(n,a);if(e[a]===i)return;if(e[f]){var u=window[e.id];if(!u)return;"tag"===a?console.error(""):"inner"===a?"string"==typeof i||"number"==typeof i?u.innerText=i:_(i)?(i=h(i),u.innerHTML="",u.appendChild(t.element(i))):Array.isArray(i)&&(i=i.map(h),u.innerHTML="",i.map(t.element).forEach(e=>u.appendChild(e))):"value"===a?u.value=i:"checked"===a?u.checked=i:"string"==typeof a&&y(u,a,i)}_(i)&&(i=m(i,r));a in e||E(n,e,a);if(e[a]=i,!s)return;var c=Array.from(s.infls),l=Array.from(s.deps);s.infls.clear(),s.deps.clear(),g(s),l.forEach(e=>{e.infls.delete(s)}),c.forEach(e=>{e.deps.clear(),g(e),function e(r){r.infls.forEach(r=>{r.deps.clear(),g(r),e(r)})}(e)})}});for(var a in v.push(n),e)if(!a.toLowerCase||!o.includes(a.toLowerCase())){var i=E(n,e,a);_(e[a])&&(e[a]=m(e[a],r)),C(e[a])&&(e[a]=w(e[a],i),e[a].forEach((t,n)=>{_(t)&&(e[a][n]=m(t,r))})),n[a]}return n}function g(e){if(delete e.value,e.proxy[e.key],e.desc[f]){var r=e.desc,n=e.key,o=window[r.id];if(!o)return;var a=e.value;"tag"===n?console.error():"inner"===n?"string"==typeof a||"number"==typeof a?o.innerText=a:u(a)?(a=h(a),o.innerHTML="",o.appendChild(t.element(a))):Array.isArray(a)&&(a=a.map(h),o.innerHTML="",a.map(t.element).forEach(e=>o.appendChild(e))):"value"===n?o.value=a:"checked"===n?o.checked=a:y(o,n,a)}}function y(e,r,t){"string"==typeof t||"number"==typeof t?e.setAttribute(r,t):e.removeAttribute(r)}function w(e,n){var o=[];return new class extends Array{map(e){var t=e;e=((e,r)=>Epos.stop(()=>t(e,r)));var n=new Array(...r.map.call(this,e)),a=p[p.length-1],i=w(n,a);return o.push({m:i,iterator:e,node:a}),i}_pushUnshift(e,n){_(e)&&(e=m(e)),o.forEach(({m:r,iterator:o,node:a})=>{var i=o(e,r.length);if(_(i)&&(i=m(i)),r[n](i),i&&i.__desc&&i.__desc[f]&&(i.__desc,(a=r.getNode())&&a.desc)){var s=window[a.desc.id];"push"===n?(console.log("add elem"),s.appendChild(t.element(i))):s.insertAdjacentElement("afterbegin",t.element(i))}}),r[n].call(this,e)}unshift(e){this._pushUnshift(e,"unshift")}push(e){this._pushUnshift(e,"push")}pop(){if(this.length){var e=this[this.length-1];return this.splice(this.length-1),e}}shift(){if(this.length){var e=this[0];return this.splice(0,1),e}}splice(e,t){r.splice.call(this,e,t),o.forEach(({m:r})=>{Array.from(Array(t)).forEach((t,n)=>{var o=window[r[e+n].id];o&&(o.outerHTML="")}),r.splice(e,t)})}getNode(){return n}}(...e)}var b=[],A=new Map;function E(e,r,t){var n=E,o={id:n.nodeId||(n.nodeId=0),desc:r,key:t,deps:new Set,infls:new Set,proxy:e};return n.nodeId+=1,A.get(e)||A.set(e,{}),A.get(e)[t]=o,b.push(o),o}function k(e,r){return A.get(e)?A.get(e)[r]:null}function _(r){return u(r)&&!r.__isProxy&&"[object Object]"===e.toString.call(r)}function C(e){return Array.isArray(e)}var L=Symbol("eposHooks")})();
