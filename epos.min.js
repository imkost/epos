(()=>{var e=Object.prototype,r=Array.prototype,n={element:i},t=["tag","inner"];function i(e){if(Array.isArray(e))return f(e).map(i);if("number"==typeof e&&(e=e.toString()),"string"==typeof e)return document.createTextNode(e);!function(e){c(e.href)&&!e.tag&&(e.tag="a")}(e);var r=function(e){if("tag"in e){var r=e.tag;if(o(r)&&/^[\w-]+$/.test(r))return r;throw""}return"div"}(e),n=function(e){if("inner"in e)return f(e.inner).map(i);return[]}(e),t=document.createElement(r);for(var u in e)a(u)||t.setAttribute(u,e[u]);return n.forEach(e=>{t.appendChild(e)}),t}function a(e){return t.includes(e)}function o(e){return"string"==typeof e}function u(r){return"[object Object]"===e.toString.call(r)}function c(e){return o(e)&&e}function f(e){return Array.isArray(e)?function e(r){var n=[];r.forEach(r=>{Array.isArray(r)?n=n.concat(e(r)):n.push(r)});return n}(e):[e]}window.Epos={element:function(e){return n.element(Epos.view(e))},object:h,view:p,stop:function(e){var r=s[s.length-1];if(r){r.freeze=!0;var n=e();r.freeze=!1}else var n=e();return n}};var s=[],d=1,l=Symbol("affectsView");function p(e){return h(e,!0)}var v=[];function h(e,r=!1){e.inner&&(r=!0),r&&(e[l]=!0,e.id=`epos${d}`,d+=1);var t=new Proxy(e,{get:function(n,i){if(i===l)return e[l];if("__desc"===i)return e;if("__isProxy"===i)return!0;var a=E(t,i);if(!a)return e[i];if(!("value"in a)){var o=e[i];"function"==typeof o&&(s.push(a),o=o(),s.pop(),b(o)&&(o=h(o,r)),_(o)&&o.forEach((e,n)=>{b(e)&&(o[n]=h(e,r))})),a.value=o}if(s.length){var u=s[s.length-1];u.freeze||(a.infls.add(u),u.deps.add(a))}return a.value},set:function(i,a,o){var u=E(t,a);if(e[a]===o)return;if(e[l]){var c=window[e.id];if(!c)return;"tag"===a?console.error(""):"inner"===a?"string"==typeof o||"number"==typeof o?c.innerText=o:b(o)?(o=p(o),c.innerHTML="",c.appendChild(n.element(o))):Array.isArray(o)&&(o=o.map(p),c.innerHTML="",o.map(n.element).forEach(e=>c.appendChild(e))):"value"===a?c.value=o:"checked"===a?c.checked=o:"string"==typeof a&&c.setAttribute(a,o)}b(o)&&(o=h(o,r));a in e||A(t,e,a);if(e[a]=o,!u)return;var f=Array.from(u.infls),s=Array.from(u.deps);u.infls.clear(),u.deps.clear(),y(u),s.forEach(e=>{e.infls.delete(u)}),f.forEach(e=>{e.deps.clear(),y(e),function e(r){r.infls.forEach(r=>{r.deps.clear(),y(r),e(r)})}(e)})}});for(var i in v.push(t),e){var a=A(t,e,i);b(e[i])&&(e[i]=h(e[i],r)),_(e[i])&&(e[i]=m(e[i],a),e[i].forEach((n,t)=>{b(n)&&(e[i][t]=h(n,r))})),t[i]}return t}function y(e){if(delete e.value,e.proxy[e.key],e.desc[l]){var r=e.desc,t=e.key,i=window[r.id];if(!i)return;var a=e.value;"tag"===t?console.error():"inner"===t?"string"==typeof a||"number"==typeof a?i.innerText=a:u(a)?(a=p(a),i.innerHTML="",i.appendChild(n.element(a))):Array.isArray(a)&&(a=a.map(p),i.innerHTML="",a.map(n.element).forEach(e=>i.appendChild(e))):"value"===t?i.value=a:"checked"===t?i.checked=a:i.setAttribute(t,a)}}function m(e,t){var i=[];return new class extends Array{map(e){var n=e;e=((e,r)=>Epos.stop(()=>n(e,r)));var t=new Array(...r.map.call(this,e)),a=s[s.length-1],o=m(t,a);return i.push({m:o,iterator:e,node:a}),o}push(e){b(e)&&(e=h(e)),i.forEach(({m:r,iterator:t,node:i})=>{var a=t(e,r.length);b(a)&&(a=h(a)),r.push(a),a&&a.__desc&&a.__desc[l]&&(a.__desc,(i=r.getNode())&&i.desc&&window[i.desc.id].appendChild(n.element(a)))}),r.push.call(this,e)}splice(e){r.splice.call(this,e,1),i.forEach(({m:r})=>{var n=window[r[e].id];n&&(n.outerHTML=""),r.splice(e,1)})}getNode(){return t}}(...e)}var g=[],w=new Map;function A(e,r,n){var t=A,i={id:t.nodeId||(t.nodeId=0),desc:r,key:n,deps:new Set,infls:new Set,proxy:e};return t.nodeId+=1,w.get(e)||w.set(e,{}),w.get(e)[n]=i,g.push(i),i}function E(e,r){return w.get(e)?w.get(e)[r]:null}function b(r){return u(r)&&!r.__isProxy&&"[object Object]"===e.toString.call(r)}function _(e){return Array.isArray(e)}})();
