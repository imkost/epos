(()=>{var e={html:t},r=["tag","inner","innerHTML","outerHTML"],n=["area","base","br","col","command","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"];function t(e){if(u(e))return e?{__raw__:e}:null;if(!c(e))throw"Invalid input, object is expected";if("outerHTML"in e){var r=e.outerHTML;if(u(r))return r;if(o(r))return r.toString();if(r)throw"Invalid outerHTML";return""}var t=function(e){if("tag"in e){var r=e.tag;if(u(r)&&/^[\w-]+$/.test(r))return r;throw"Invalid tag name"}if(f(e.href))return"a";return"div"}(e),p=function(e){if("innerHTML"in e){var r=e.innerHTML;if(u(r))return r;if(o(r))return r.toString();if(r)throw"Invalid innerHTML";return""}if("inner"in e)return s(e.inner).map(i).join("");return""}(e),d=function(e){var r="";for(var n in e)if(!a(n)){var t=e[n];"class"===n&&(t=s(t).filter(f).join(" ").trim().replace(/\s+/g," "));var i=l(n);!0===t?r+=` ${i}`:o(t)?r+=` ${i}="${t}"`:u(t)?r+=` ${i}="${l(t)}"`:t&&(t=t.__raw__?t.__raw__:l(JSON.stringify(t)),r+=` ${i}="${t}"`)}return r}(e);return function(e){return n.includes(e.toLowerCase())}(t)?`<${t}${d} />`:`<${t}${d}>${p}</${t}>`}function i(e){return o(e)?e.toString():u(e)?l(e):c(e)?e.__raw__?e.__raw__:t(e):""}function a(e){return r.includes(e)}function o(e){return"number"==typeof e&&!isNaN(e)}function u(e){return"string"==typeof e}function c(e){return"[object Object]"===Object.prototype.toString.call(e)}function f(e){return u(e)&&e}function l(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(e){return M(e)?function e(r){var n=[];r.forEach(r=>{M(r)?n=n.concat(e(r)):n.push(r)});return n}(e):[e]}window.Epos={element:function(r){var n=document.createElement("div");return n.innerHTML=e.html(r),n=n.firstElementChild},object:h,view:g,stop:function(e){var r=p[p.length-1];if(r){r.freeze=!0;var n=e();r.freeze=!1}else var n=e();return n}};var p=[],d=1,v=Symbol("affectsView");function g(e){return h(e,!0)}var m=[];function h(r,n=!1){r.inner&&(n=!0);var t=new Proxy(r,{get:function(e,i){if("__desc"===i)return r;if("__isProxy"===i)return!0;var a=A(t,i);if(!a)return r[i];if(!("value"in a)){var o=r[i];"function"==typeof o&&(p.push(a),o=o(),p.pop(),L(o)&&(o=h(o,n)),M(o)&&o.forEach((e,r)=>{L(e)&&(o[r]=h(e,n))})),a.value=o}if(p.length){var u=p[p.length-1];u.freeze||(a.infls.add(u),u.deps.add(a))}return a.value},set:function(i,a,o){var u=A(t,a);if(r[v]){var c=window[r.id];if(!c)return;"tag"===a?console.log("tag change is not implemented"):"inner"===a?"string"==typeof o||"number"==typeof o?c.innerText=o:L(o)?(o=createView(o),c.innerHTML=e.html(o)):Array.isArray(o)&&(o=o.map(createView),c.innerHTML=o.map(e.html).join("")):c.setAttribute(a,o)}L(o)&&(o=h(o,n));a in r||T(t,r,a);r[a]=o;var f=Array.from(u.infls),l=Array.from(u.deps);u.infls.clear(),u.deps.clear(),y(u),l.forEach(e=>{e.infls.delete(u)}),f.forEach(e=>{e.deps.clear(),y(e),function e(r){r.infls.forEach(r=>{r.deps.clear(),y(r),e(r)})}(e)})}});for(var i in m.push(t),n&&(r[v]=!0,r.id=`epos${d}`,d+=1),r){var a=T(t,r,i);L(r[i])&&(r[i]=h(r[i],n)),M(r[i])&&(r[i]=w(r[i],a),r[i].forEach((e,t)=>{L(e)&&(r[i][t]=h(e,n))})),t[i]}return t}function y(r){if(delete r.value,r.proxy[r.key],r.desc[v]){var n=r.desc,t=r.key,i=window[n.id],a=r.value;"tag"===t?console.log("tag change is not implemented"):"inner"===t?"string"==typeof a||"number"==typeof a?i.innerText=a:L(a)?(a=g(a),i.innerHTML=e.html(a)):Array.isArray(a)&&(a=a.map(g),i.innerHTML=a.map(e.html).join("")):i.setAttribute(t,a)}}function w(r,n){var t=[];return new class extends Array{map(e){var r=e;e=((e,n)=>Epos.stop(()=>r(e,n)));var n=new Array(...Array.prototype.map.call(this,e)),i=p[p.length-1],a=w(n,i);return t.push({m:a,iterator:e,node:i}),a}push(r){L(r)&&(r=h(r)),t.forEach(({m:n,iterator:t,node:i})=>{var a=t(r,n.length);L(a)&&(a=h(a)),n.push(a),a&&a.__desc&&a.__desc[v]&&(a.__desc,(i=n.getNode())&&i.desc&&window[i.desc.id].insertAdjacentHTML("beforeend",e.html(a)))}),Array.prototype.push.call(this,r)}splice(e){Array.prototype.splice.call(this,e,1),t.forEach(({m:r})=>{var n=window[r[e].id];n&&(n.outerHTML=""),r.splice(e,1)})}getNode(){return n}}(...r)}var _=[],b=new Map;function T(e,r,n){var t=T,i={id:t.nodeId||(t.nodeId=0),desc:r,key:n,deps:new Set,infls:new Set,proxy:e};return t.nodeId+=1,b.get(e)||b.set(e,{}),b.get(e)[n]=i,_.push(i),i}function A(e,r){return b.get(e)?b.get(e)[r]:null}function L(e){return"object"==typeof e&&!e.__isProxy&&"[object Object]"===Object.prototype.toString.call(e)}function M(e){return Array.isArray(e)}})();
